---
title: インストール後の手順
description: Mastodonのインストールが完了した後にやること
menu:
  docs:
    parent: administration
    weight: 3
---


## コマンドラインインターフェースを使う

MastodonのコマンドラインインターフェースはMastodonのルートディレクトリにある`bin`ディレクトリの`tootctl`という実行ファイルです。`RAILS_ENV`環境変数を使って、実行するたびに使用する環境を指定する必要があります。ローカルマシンで作業する開発者でない限り、`RAILS_ENV=production`を使用する必要があります。別の環境（開発、テスト、またはステージング用）が必要ないことが確実な場合は、簡便のため`.bashrc`にファイルに以下のように追加できます。

```bash
echo "export RAILS_ENV=production" >> ~/.bashrc
```

これで、毎回環境を指定する必要はなくなります。それ以外の場合、`/home/mastodon/live`にMastodonコードがあるとすると、`tootctl`への呼び出しは通常次のようになります。

```bash
cd /home/mastodon/live
RAILS_ENV=production bin/tootctl help
```

## 管理者アカウントの作成
### ブラウザを使用

ブラウザでサインアップした後、コマンドラインを使用して、新しく作成したアカウントに管理者権限を付与する必要があります。`alice`というユーザーに付与するなら、

```bash
RAILS_ENV=production bin/tootctl accounts modify alice --role admin
```

### コマンドラインを使用

コマンドラインでアカウントを作ることもできます。

```bash
RAILS_ENV=production bin/tootctl accounts create \
  alice \
  --email alice@example.com \
  --confirmed \
  --role admin
```

ランダムに生成されたパスワードがターミナルに表示されます。

## サーバー情報を書き加える

ログイン後、**サイト設定**ページに移動します。この情報を入力するための技術的な要件はありませんが、コンピュータというより人間向けの設定と言えます。

|設定|意味|
|-------|-------|
|連絡先ユーザー名 |他の人が管理者だとわかるようにするために必要 |
|ビジネスメールアドレス| アカウントがロックされたり、サーバー外部の人から連絡を受けるために必要 |
|サーバーの説明| サーバーの個性を説明|
|短いサーバーの説明| もっと短い説明 |

「変更の保存」を押して保存します。

## 定期的なバックアップ(強く推奨)

サーバーを表に出すのであれば、Mastodonサーバーのバックアップは必須です。

### 概要

バックアップすべきものを重要度順に並べています。

1. PostgreSQLデータベース
2. `.env.production`等の機密ファイル
3. ユーザーがアップロードしたファイル
4. Redisデータベース

### 「失敗」と「その後」

一般に人間が回避することができる障害のタイプは2つあります。

1. ディスク上のデータ破損などのハードウェアの障害特定のデータの不正な削除など
1. 人的およびソフトウェアのエラー

このドキュメントでは、1.のみを扱います。

PostgreSQLのデータベースを失ってしまった場合、もうお手上げ状態です。Mastodonは重要なデータのほぼ全てをPostgreSQLデータベースに保存しています。この場合、全てのアカウントや投稿、フォロワー情報なども失われます。

機密ファイルを失ってしまった場合、一部のMastodonの機能が利用不可になります。ユーザーはログアウトされ、2要素認証は利用できなくなり、Web Push APIは機能しなくなります。

ユーザーがアップロードしたファイルを失うということは、アバター、ヘッダー、メディアの添付ファイルが失われるということですが、Mastodon自体は停止しません。

Redisデータベースを失ってもほとんど無害です。回復不能なデータは、Sidekiqキューの内容と、以前に失敗したジョブのスケジュールされた再試行だけです。ホームフィードとリストフィードはRedisに保存されますが、tootctlを使用して再生成できます。

最適なバックアップは、いわゆるオフサイトバックアップ、つまりMastodon自体と同じマシンに保存されていないバックアップです。ホストされているサーバーのハードディスクドライブが爆発した場合、同じハードドライブに保存されているバックアップはあまり役に立ちません。

### 機密ファイルのバックアップ

アプリケーションの機密ファイルは変更されないため、バックアップが最も簡単です。`.env.production`をどこか安全なところに保存してください。

### PostgreSQLのバックアップ

PostgreSQLは、停電、ハードディスクドライブの障害、スキーマの移行の失敗によるデータ破損の危険にさらされています。そのため、ときどき`pg_dump`または`pg_dumpall`でバックアップを作成することをおすすめします。

高可用性が求められる場合、ホットストリーミングレプリケーションを使用して、常に最新のデータを持つ2番目のPostgreSQLサーバーを用意し、他のサーバーがダウンした場合に切り替えることができます。

### ユーザーがアップロードしたファイルのバックアップ

Amazon S3、Google Cloud、Wasabiなどの外部オブジェクトストレージを使用している場合、これらのバックアップについて心配する必要はありません。各企業は、ハードウェア障害の処理に責任を負っています。
ローカルファイルストレージを使用している場合、アップロードされたファイルはデフォルトで`public/system`に保存されます。この可変ディレクトリのコピーを作成するのはあなた次第です。

### Redisのバックアップ

Redisのバックアップは簡単です。Redisは、`/var/lib/redis/dump.rdb`にバックアップが必要な内容の全てを含んでいます。
